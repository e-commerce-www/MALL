{% extends "base.html" %}

{% load session_filters %}

{% block extra-style %}
<style>
    .heart-white {
        color: white;
    }

    .heart-red {
        color: red;
    }

    .btn-sm {
        background-color: rgb(49, 49, 49);
        padding: auto;
        line-height: auto; /* ì¤„ê°„ê²© ì¡°ì • */
        height: auto; /* ë²„íŠ¼ ë†’ì´ ì¡°ì • */
        color: rgb(255, 255, 255);
    }

    .col-md-5{
        display: flex; 
        flex-direction: column; 
        justify-content: space-between;
    }

    .btn-outline-light {
        color: rgb(255, 255, 255); 
        background-color: none; 
        border: none;
        position: relative;
        display: flex;
        align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        width: 20px; /* ë²„íŠ¼ ë„ˆë¹„ ì„¤ì • */
        height: 20px; /* ë²„íŠ¼ ë†’ì´ ì„¤ì • */
        margin-top: -20px;
    }

    .btn-outline-light-rm{
        color: rgb(255, 0, 0); /* ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        background-color: transparent; 
        border: none;
        position: relative;
        display: flex;
        align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        width: 20px; /* ë²„íŠ¼ ë„ˆë¹„ ì„¤ì • */
        height: 20px; /* ë²„íŠ¼ ë†’ì´ ì„¤ì • */
        margin-top: -20px;
    }
</style>
{% endblock extra-style %}

{% block content %}
<div class="container">
    <div class="row" style="border-radius: 20px;">
        <!-- Left column for the song image -->
        <div class="col-md-4 text-center" style="margin-left: 20%;">
            <img src="{{ song.thumbnail.url }}" alt="{{ song.title }}" class="img-fluid rounded" style="max-width: 100%; height: auto;">
        </div>

        <!-- Right column for the song details -->
        <div class="col-md-5">
            <h3 class="card-title" style="color: rgb(255, 255, 255); margin-bottom: 20px;">{{ song.title }}</h3>
            {% is_added_to_cart user song.id as added %}<!-- ì°œí•œ ëª©ë¡ì— ìˆìœ¼ë©´ -->
            {% if not added %}
            <button id="toggle-btn" class="btn btn-outline-light" onclick="toggleButtonColor()">ğŸ¤</button> <!-- í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ -->
            {% else %}
            <button id="toggle-btn" class="btn btn-outline-light-rm" onclick="toggleButtonColor()">â¤ï¸</button> <!-- í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ -->
            {% endif %}
            <button id="like-btn" class="btn btn-outline-primary" onclick="toggleLike()" style="color: white; width: calc(30%);">
                Like
            </button>
            <button type="button" class="btn btn-outline-danger" style="width: 30%;">Musician Follow</button>
            <div class="d-flex">
                <div class="me-4">
                    <h6 style="color: aliceblue;">Made by</h6>
                    <a href="{% url 'sellers:seller_detail' song.seller.id %}" class="btn btn-sm">{{ song.seller }}</a>
                </div>
                <div>
                    <h6 style="color: aliceblue;">ì¥ë¥´</h6>
                    <p class="btn btn-sm" style="background-color: rgb(49, 49, 49);">{{ song.genre }}</p>
                </div>
                <div style="margin-left: 20px;">
                    <h6 style="color: aliceblue;">Tempo</h6>
                    <p class="btn btn-sm" style="background-color: rgb(49, 49, 49);">{{ song.display_tempo }}</p>
                </div>
                
            </div>
            <audio controls class="w-100" controlsList="nodownload">
                <source src="{% url 'songs:song_stream' song.id %}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
    </div>
    <!-- Comments section -->
    <div class="card my-4" style="background-color: rgb(20, 20, 20); border:none">
        <hr style="border-top: 1px solid white;">
        <h5 class="card-header" style="color: aliceblue;">Comments:</h5>
        <hr style="border-top: 1px solid white;">
        <div class="card-body">
            <form>
                <div class="mb-3">
                    <textarea class="form-control" rows="3" style="background-color: rgb(46, 46, 46);"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">ì‘ì„±ì™„ë£Œ</button>
            </form>
        </div>
    </div>
</div>
{% endblock content %}


{% block extra-script %}
<script>
    // ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ì°œ ëª©ë¡ì— ì¶”ê°€ ë˜ëŠ” ì œê±°í•˜ëŠ” í•¨ìˆ˜
    function toggleButtonColor() {
        const btn = document.getElementById('toggle-btn');
        const added = btn.classList.contains('btn-outline-light-rm'); // ë¹¨ê°„ìƒ‰ í•˜íŠ¸ì¸ì§€ í™•ì¸

        if (added) {
            removeFromCart(); // ì°œ ëª©ë¡ì—ì„œ ì œê±°
        } else {
            addToCart(); // ì°œ ëª©ë¡ì— ì¶”ê°€
        }
    }

    // ì°œ ëª©ë¡ì— ë…¸ë˜ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
    function addToCart() {
        const addBtn = document.getElementById('toggle-btn');
        axios({
            method: 'get',
            url: '{% url "carts:add_song" %}',
            params: {
                songid: '{{ song.id }}'
            }
        })
            .then(response => {
                addBtn.classList.remove('btn-outline-light');
                addBtn.classList.add('btn-outline-light-rm');
                addBtn.textContent = 'â¤ï¸';
                alert('ì°œ ëª©ë¡ì— "{{ song.title }}"ì„(ë¥¼) ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.');
            })
            .catch(error => console.log(error));
    }

    // ì°œ ëª©ë¡ì—ì„œ ë…¸ë˜ë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜
    function removeFromCart() {
        const removeBtn = document.getElementById('toggle-btn');
        axios({
            method: 'get',
            url: '{% url "carts:remove_song" %}',
            params: {
                songid: '{{ song.id }}'
            }
        })
            .then(response => {
                removeBtn.classList.remove('btn-outline-light-rm');
                removeBtn.classList.add('btn-outline-light');
                removeBtn.textContent = 'ğŸ¤';
                alert(response.data.success);
            })
            .catch(error => console.log(error));
    }

    // ì¢‹ì•„ìš” ë²„íŠ¼ì„ í† ê¸€í•˜ëŠ” í•¨ìˆ˜
    function toggleLike() {
        const likeBtn = document.getElementById('like-btn');
        const liked = likeBtn.classList.contains('liked'); // ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ëŠ”ì§€ í™•ì¸

        if (liked) {
            dislike(); // ì¢‹ì•„ìš” ì·¨ì†Œ
        } else {
            like(); // ì¢‹ì•„ìš”
        }
    }

        // ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œì˜ ë™ì‘
    function like() {
        const likeBtn = document.getElementById('like-btn');
        likeBtn.textContent = 'Liked!';
        likeBtn.style.backgroundColor = '#007bff'; // primary ìƒ‰ìƒìœ¼ë¡œ ë‚´ë¶€ ìƒ‰ìƒ ë³€ê²½
        likeBtn.style.color = '#ffffff'; // í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½
        likeBtn.style.borderColor = '#007bff'; // í…Œë‘ë¦¬ ìƒ‰ìƒì„ primaryë¡œ ìœ ì§€
        likeBtn.classList.add('liked'); // ì¢‹ì•„ìš” ìƒíƒœë¡œ í´ë˜ìŠ¤ ì¶”ê°€
    }

    function dislike() {
        const likeBtn = document.getElementById('like-btn');
        likeBtn.textContent = 'Like';
        likeBtn.style.backgroundColor = ''; // ë‚´ë¶€ ìƒ‰ìƒ ì´ˆê¸°í™”
        likeBtn.style.color = ''; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì´ˆê¸°í™”
        likeBtn.style.borderColor = ''; // í…Œë‘ë¦¬ ìƒ‰ìƒ ì´ˆê¸°í™”
        likeBtn.classList.remove('liked'); // ì¢‹ì•„ìš” ìƒíƒœ í´ë˜ìŠ¤ ì œê±°
    }
</script>
{% endblock extra-script %}
