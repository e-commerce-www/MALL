{% extends "base.html" %}
{% load session_filters %}
{% load thumbnail %}
{% block extra-style %}
<style>

@media (max-width:576px) {
    div.col {
        position: relative;
    }
    div.col-md-4.text-center {
        display: block;
        width:50%;
        margin-left: auto !important;
        margin-right: auto !important
    }


    #like-btn,#follow-btn {
        position: absolute;
        right: 0%;
    }

    .mt-4.d-flex.flex-column.flex-md-row {
        align-items: flex-start; /* ìˆ˜ì§ ì •ë ¬ì€ flex-startë¡œ ì„¤ì • */
    }
    .button-container {
        margin-top: 5px;
        flex: 1;
        align-items: center; /* ë²„íŠ¼ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        flex-wrap: wrap; /* í•„ìš”ì— ë”°ë¼ ë²„íŠ¼ì´ ë„˜ì¹  ê²½ìš° ì¤„ ë°”ê¿ˆ */
    }
    .wishbutton-custom-style,.buybutton-custom-style {
        white-space: nowrap;
        display: inline-flex;
        justify-content: center;
        align-items: left;
        font-size: 1em;
        margin-right: 10px;
        width: auto;
   
    }
}



</style>
{% endblock extra-style %}
{% block content %}

<head>
    <style>
        .kakao-link-btn img {
            width: 50px;
            /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
            height: 50px;
            /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
            border-radius: 10px;
            /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ì ìš© */
            transition: transform 0.3s ease;
            /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œì˜ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        }

        .kakao-link-btn img:hover {
            transform: scale(1.1);
        }


        .instagram-btn {
            display: inline-block;
            border: none;
            cursor: pointer;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .instagram-btn img {
            width: 50px;
            /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
            height: 50px;
            /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
            border-radius: 10px;
            /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ì ìš© */
            transition: transform 0.3s ease;
            /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œì˜ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        }

        .instagram-btn img:hover {
            transform: scale(1.1);
            /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ì´ë¯¸ì§€ í™•ëŒ€ íš¨ê³¼ */
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #toast {
            visibility: hidden;
            /* ì²˜ìŒì—ëŠ” ë³´ì´ì§€ ì•ŠìŒ */
            min-width: 250px;
            /* ìµœì†Œ ë„ˆë¹„ */
            background-color: #333;
            /* ë°°ê²½ ìƒ‰ìƒ */
            color: #fff;
            /* ê¸€ì ìƒ‰ìƒ */
            text-align: center;
            /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            border-radius: 20px;
            /* ëª¨ì„œë¦¬ ê³¡ë¥  */
            padding: 16px;
            /* ë‚´ë¶€ ì—¬ë°± */
            position: fixed;
            /* ê³ ì • ìœ„ì¹˜ */
            z-index: 1;
            /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            left: 50%;
            /* ì™¼ìª½ì—ì„œ 50% ìœ„ì¹˜ */
            top: 50%;
            /* ìƒë‹¨ì—ì„œ 50% ìœ„ì¹˜ */
            transform: translate(-50%, -50%);
            /* ì •í™•í•œ ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ ì¡°ì • */
            font-size: 17px;
            /* ê¸€ì í¬ê¸° */
        }

        /* í† ìŠ¤íŠ¸ì°½ ë³´ì—¬ì£¼ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        #toast.show {
            visibility: visible;
            /* ë³´ì´ê²Œ í•¨ */
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @-webkit-keyframes fadein {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadein {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @-webkit-keyframes fadeout {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes fadeout {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }
    </style>
</head>
<!---css-->

<div class="container">
    <div class="row" style="border-radius: 20px;">
        <!-- Left column for the song image -->
        <div class="col-md-4 text-center " style="margin-left: 20%;">
            {% thumbnail song.thumbnail "300x300" crop="center" as thumb %}
            <img src="{{ thumb.url }}" alt="{{ song.title }}" class="rounded-2 "
                style="max-width: 100%; height: auto; border: 1px solid hsla(0, 0%, 100%, .3);">
            {% endthumbnail %}
        </div>

        <!-- Right column for the song details -->
        <div class="col">
            <h1 class="card-title fs-2" style="color: aquamarine;">{{ song.title }}
                {% if user.is_authenticated %}
                {% if like %}
                <a class="btn btn-danger" id="like-btn" onclick="likeFunc('{{song.id}}');">ì¢‹ì•„ìš” ì·¨ì†Œ</a>
                {% else %}
                <a class="btn btn-outline-danger" id="like-btn" onclick="likeFunc('{{song.id}}');">ì¢‹ì•„ìš”</a>
                {% endif %}
                {% else %}
                <a class="btn btn-outline-danger" onclick="gotoLogin();">ì¢‹ì•„ìš”</a>
                {% endif %}
            </h1>
            <div class="mt-2 align-content-center align-items-center  d-flex ">
                <span style="background-color: black; border-radius: 8px; color: navajowhite; padding: 5px;">ì•„í‹°ìŠ¤íŠ¸</span>
                <h2 class="fs-5 text-white mx-2 m-0" style="display: inline-block; ">
                    <a class="text-decoration-none" style="color:orange"
                        href="{% url 'sellers:seller_artist' song.seller.user.id %}">{{song.seller}}</a>
                    {% if user.is_authenticated %}
                    {% if not song.seller.user == user %}
                    {% if follow %}
                    <a class="btn btn-danger" style="margin-left: 7px;" id="follow-btn"
                        onclick="followArtist('{{song.seller.user.id}}')">íŒ”ë¡œìš° ì·¨ì†Œ</a>
                    {% else %}
                    <a class="btn btn-primary" style="margin-left: 7px;" id="follow-btn"
                        onclick="followArtist('{{song.seller.user.id}}')">íŒ”ë¡œìš°</a>
                    {% endif %}
                    {% endif %}
                    {% else %}
                    <a class="btn btn-outline-primary text-white" style="margin-left: 7px;"
                        onclick="gotoLogin();">íŒ”ë¡œìš°</a>
                    {% endif %}
                </h2>
            </div>
            <div class="mt-3 align-content-center align-items-center  d-flex ">
                <span style="background-color: black; border-radius: 8px; color: navajowhite; padding: 5px;">ì¥ë¥´</span>
                <span style="background-color: black; border-radius: 8px; color: aqua; padding: 5px;">{{song.display_genre }}</span>
            </div>
            <div class="mt-3  align-content-center align-items-center  d-flex ">
                <span style="background-color: black; border-radius: 8px; color: navajowhite; padding: 5px;">í…œí¬</span>
                <span style="background-color: black; border-radius: 8px; color: aqua; padding: 5px;">{{song.display_tempo }}</span>

            </div>
            <div class="mt-3 align-content-center align-items-center  d-flex ">
                <span style="background-color: black; border-radius: 8px; color: navajowhite; padding: 5px;">ê°€ì‚¬</span>
                <span style="background-color: black; border-radius: 8px; color: aqua; padding: 5px;">
                    <a class="btn btn me-2 text-white" style="cursor: pointer;" data-id="{{ song.id }}"
                        onclick="showLyrics(this.getAttribute('data-id'))">ğŸ“ƒ</a>
                </span>
            </div>
            <br>
            <!-- ì¹´ì¹´ì˜¤í†¡ ê³µìœ  -->
            <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
                integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4"
                crossorigin="anonymous"></script>
            <script>
                Kakao.init('{{kakao_javascript_key}}'); // ì‚¬ìš©í•˜ë ¤ëŠ” ì•±ì˜ JavaScript í‚¤ ì…ë ¥
            </script>

            <a id="kakaotalk-sharing-btn" class="kakao-link-btn" href="javascript:;">
                <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png"
                    alt="ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë³´ë‚´ê¸° ë²„íŠ¼" />
            </a>

            <script>
                Kakao.Share.createCustomButton({
                    container: '#kakaotalk-sharing-btn',
                    templateId: 108578,
                    templateArgs: {
                        thumb: "{{ song.thumbnail.url }}",
                        title: "{{ song.title }}",
                        seller: "{{ song.seller }}",
                    },
                });
            </script>

            <!-- ì¸ìŠ¤íƒ€ê·¸ë¨ ê³µìœ  -->
            <a href="https://www.instagram.com/direct/inbox/" class="instagram-btn">
                <img src="/uploads/insta.jpeg" alt="Instagram Icon" />
            </a>

            <div id="toast">ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

            <script>
                // í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì†Œë¥¼ ì°¾ê¸° ìœ„í•´ querySelector ì‚¬ìš©
                document.querySelector('.instagram-btn').addEventListener('click', function (event) {
                    event.preventDefault();

                    const url = window.location.href; // í˜„ì¬ í˜ì´ì§€ URL ê°€ì ¸ì˜¤ê¸°

                    // modern APIë¥¼ ì‚¬ìš©í•˜ì—¬ í´ë¦½ë³´ë“œì— í…ìŠ¤íŠ¸ ë³µì‚¬
                    navigator.clipboard.writeText(url).then(function () {
                        // ì‚¬ìš©ìì—ê²Œ ë³µì‚¬ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
                        var toast = document.getElementById("toast");
                        toast.className = "show";
                        setTimeout(function () {
                            toast.className = toast.className.replace("show", "");
                            // ì¸ìŠ¤íƒ€ê·¸ë¨ í˜ì´ì§€ë¥¼ ìƒˆë¡œìš´ ì°½ìœ¼ë¡œ ì—´ê¸°
                            window.open('https://www.instagram.com/direct/inbox/', '_blank');
                        }, 1000);
                    }).catch(function (error) {
                        console.error('ë³µì‚¬ë¥¼ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ', error);
                    });
                });
            </script>
            <!-- ì¸ìŠ¤íƒ€ê·¸ë¨ ê³µìœ  -->


            <div class="mt-4 d-flex flex-column flex-md-row">
                <audio controls class="me-3 " controlsList="nodownload"  style="flex-shrink: 0; margin-right: 3%;">
                    <source src="{{ song.mp3.url }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                <div class="button-container d-flex justify-content-left">
                    {% if user.is_authenticated %}
                    {% is_purchased user song.id as purchased %}
                    {% is_added_to_cart user song.id as added %}
                    {% if purchased %}
                    <a href="{{ song.mp3.url }}" download="{{ song.title }}.mp3"
                        class="btn btn-outline-light me-2  buybutton-custom-style text-center d-flex ">
                        ë‹¤ìš´ë¡œë“œ
                    </a>
                    {% else %}
                    <form action="{% url 'payments:payment_pay' song.id %}"
                        onsubmit="return confirmPurchase('{{ song.title|escapejs }}')">
                        <button class="btn btn me-2 buybutton-custom-style" type="submit" onclick=""
                            style="height: 100%;">ğŸ’³</button>
                    </form>
                    {% endif %}
                    {% if not added %}
                    <button id="add-btn-{{song.id}}" type="button" class="btn btn me-2 wishbutton-custom-style"
                        onclick="addToCart('{{song.id}}');">ğŸ¤</button>
                    {% else %}
                    <button id="remove-btn-{{song.id}}" type="button" class="btn btn me-2 wishbutton-custom-style"
                      onclick="removeFromCart('{{song.id}}');">â¤ï¸</button>
                    {% endif %}
                    {% else %}
                   <button class="btn btn me-2 buybutton-custom-style" onclick="gotoLogin()">ğŸ’³</button>
                   <button class="btn btn me-2 wishbutton-custom-style" onclick="gotoLogin()">ğŸ¤</button>
                   {% endif %}
                </div>
            </div>
        </div>
    </div>
    <!-- Comments section -->
    <div id="disqus_thread" class="mt-5"></div>
</div>
{% endblock content %}


{% block extra-script %}
<script>

    function followArtist(userId) {
        const followBtn = document.getElementById('follow-btn');
        if (followBtn.className == 'btn btn-primary') {
            axios({
                method: 'get',
                url: '{% url "follows:follow" %}',
                params: {
                    userid: userId
                },
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => {
                    followBtn.className = 'btn btn-danger';
                    followBtn.textContent = 'íŒ”ë¡œìš° ì·¨ì†Œ';
                })
                .catch(error => console.log(error));
        } else {
            axios({
                method: 'get',
                url: '{% url "follows:unfollow" %}',
                params: {
                    userid: userId
                },
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => {
                    followBtn.className = 'btn btn-primary';
                    followBtn.textContent = 'íŒ”ë¡œìš°';
                })
                .catch(error => console.log(error));
        }

    }

    function likeFunc(songId) {
        const likeBtn = document.getElementById('like-btn');
        if (likeBtn.className === 'btn btn-outline-danger') {
            // ì¢‹ì•„ìš”
            axios({
                method: 'get',
                url: '{% url "likes:like_do" %}',
                params: {
                    songid: songId
                },
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => {
                    likeBtn.className = 'btn btn-danger';
                    likeBtn.textContent = 'ì¢‹ì•„ìš” ì·¨ì†Œ'
                })
                .catch(error => console.log(error));

        } else {
            // ì¢‹ì•„ìš” ì·¨ì†Œ
            axios({
                method: 'get',
                url: '{% url "likes:like_cancel" %}',
                params: {
                    songid: songId
                },
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => {
                    likeBtn.className = 'btn btn-outline-danger';
                    likeBtn.textContent = 'ì¢‹ì•„ìš”'
                })
                .catch(error => console.log(error));

        }

    }

    function showLyrics(songId) {
        // ì˜ˆì œë¥¼ ìœ„í•´ ê°€ì‚¬ë¥¼ ê³ ì •ëœ ê°’ìœ¼ë¡œ ì„¤ì •, ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì‚¬ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ í•„ìš”
        const lyrics = 'ì—¬ê¸°ì— ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ê°€ì‚¬ë¥¼ ì±„ì›ë‹ˆë‹¤.';
        axios({
            method: 'get',
            url: '{% url "songs:song_lyrics" %}',
            params: {
                songid: songId
            },
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(response => {
                // ëª¨ë‹¬ì˜ ê°€ì‚¬ ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•˜ê³  ëª¨ë‹¬ì„ í‘œì‹œ
                document.getElementById('lyricsContent').innerText = response.data.success;

                // ëª¨ë‹¬ ì°½ì„ í‘œì‹œ
                var lyricsModal = new bootstrap.Modal(document.getElementById('lyricsModal'), {
                    keyboard: true
                });
                lyricsModal.show();
            })
            .catch(error => console.log(error));
    }

    function gotoLogin() {
        var loginModal = new bootstrap.Modal(document.getElementById('loginModal'), {
            keyboard: false
        });
        loginModal.show();
    }

    function addToCart(songId) {

        const addBtn = document.getElementById('add-btn-' + (songId));
        axios({
            method: 'get',
            url: '{% url "carts:add_song" %}',
            params: {
                songid: songId
            }
        })
            .then(response => {
                addBtn.id = 'remove-btn-' + response.data.song_id;  // Change the ID
                addBtn.className = 'btn btn me-2 wishbutton-custom-style';  // Change the classes
                addBtn.onclick = () => removeFromCart(songId);  // Change the onclick event
                addBtn.textContent = 'â¤ï¸';
                // alert('ì°œ ëª©ë¡ì— "' + response.data.success + '"ì„(ë¥¼) ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.');
            })
            .catch(error => console.log(error));
    }

    function removeFromCart(songId) {
        const removeBtn = document.getElementById('remove-btn-' + (songId));
        axios({
            method: 'get',
            url: '{% url "carts:remove_song" %}',
            params: {
                songid: songId
            }
        })
            .then(response => {
                removeBtn.id = 'add-btn-' + response.data.song_id;  // Change the ID
                removeBtn.className = 'btn btn me-2 wishbutton-custom-style';  // Change the classes
                removeBtn.onclick = () => addToCart(songId);  // Change the onclick event
                removeBtn.textContent = 'ğŸ¤';
                // alert(response.data.success);
            })
            .catch(error => console.log(error));
    }

    // DISQUS
    var disqus_config = function () {
        this.page.identifier = '{{ disqus_id }}';
        this.page.url = '{{ disqus_url }}';
        this.page.title = '{{ disqus_title }}';
    };

    (function () { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://music-value-platform-1.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })(); 
</script>
{% endblock extra-script %}