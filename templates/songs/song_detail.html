{% extends "base.html" %}

{% load session_filters %}

{% block extra-style %}
<style>
    .heart-white {
        color: white;
    }

    .heart-red {
        color: red;
    }

    .btn-sm {
        background-color: rgb(49, 49, 49);
        padding: auto;
        line-height: auto; /* ì¤„ê°„ê²© ì¡°ì • */
        height: auto; /* ë²„íŠ¼ ë†’ì´ ì¡°ì • */
        color: rgb(255, 255, 255);
    }

    .col-md-5{
        display: flex; 
        flex-direction: column; 
        justify-content: space-between;
    }

    .btn-outline-light {
        color: rgb(255, 255, 255); 
        background-color: none; 
        border: none;
        position: relative;
        display: flex;
        top: -40px; /* ë²„íŠ¼ì„ ìœ„ë¡œ í•œ ì¹¸ ì˜¬ë¦¼ */
        left: 0px; /* ë²„íŠ¼ì„ ì™¼ìª½ìœ¼ë¡œ ì •ë ¬ */
        width: 20px; /* ë²„íŠ¼ ë„ˆë¹„ ì„¤ì • */
        height: 20px; /* ë²„íŠ¼ ë†’ì´ ì„¤ì • */
    }

    .btn-outline-light-rm{
        color: rgb(255, 0, 0); /* ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        background-color: transparent; 
        border: none;
        position: relative;
        display: flex;
        top: -40px; /* ë²„íŠ¼ì„ ìœ„ë¡œ í•œ ì¹¸ ì˜¬ë¦¼ */
        left: 0px; /* ë²„íŠ¼ì„ ì™¼ìª½ìœ¼ë¡œ ì •ë ¬ */
        width: 20px; /* ë²„íŠ¼ ë„ˆë¹„ ì„¤ì • */
        height: 20px; /* ë²„íŠ¼ ë†’ì´ ì„¤ì • */
    }

</style>
{% endblock extra-style %}

{% block content %}
<div class="container">
    <div class="row" style="border-radius: 20px;">
        <!-- Left column for the song image -->
        <div class="col-md-4 text-center" style="margin-left: 20%;">
            <img src="{{ song.thumbnail.url }}" alt="{{ song.title }}" class="img-fluid rounded" style="max-width: 100%; height: auto;">
        </div>

        <!-- Right column for the song details -->
        <div class="col-md-5">
            <h3 class="card-title" style="color: rgb(255, 255, 255); margin-bottom: 20px;">{{ song.title }}</h3>
            {% is_added_to_cart user song.id as added %}<!-- ì°œí•œ ëª©ë¡ì— ìˆìœ¼ë©´ -->
            {% if not added %}
            <button id="toggle-btn" class="btn btn-outline-light" onclick="toggleButtonColor()">ğŸ¤</button> <!-- í°ìƒ‰ í•˜íŠ¸ë¡œ ìœ ì§€ -->
            {% else %} <!-- ì°œí•œ ëª©ë¡ì— ì—†ìœ¼ë©´ -->
            <button id="toggle-btn" class="btn btn-outline-light-rm" onclick="toggleButtonColor()">â¤ï¸</button> <!-- ë¹¨ê°„ìƒ‰ í•˜íŠ¸ë¡œ ë³€ê²½ ë° í™œì„±í™” -->
            {% endif %}
            <div class="d-flex">
                <div class="me-4">
                    <h6 style="color: aliceblue;">Made by</h6>
                    <a href="{% url 'sellers:seller_detail' song.seller.id %}" class="btn btn-sm">{{ song.seller }}</a>
                </div>
                <div>
                    <h6 style="color: aliceblue;">ì¥ë¥´</h6>
                    <p class="btn btn-sm" style="background-color: rgb(49, 49, 49);">{{ song.genre }}</p>
                </div>
            </div>
            <audio controls class="w-100" controlsList="nodownload">
                <source src="{% url 'songs:song_stream' song.id %}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
    </div>
    <!-- Comments section -->
    <div class="card my-4" style="background-color: rgb(20, 20, 20); border:none">
        <hr style="border-top: 1px solid white;">
        <h5 class="card-header" style="color: aliceblue;">Comments:</h5>
        <hr style="border-top: 1px solid white;">
        <div class="card-body">
            <form>
                <div class="mb-3">
                    <textarea class="form-control" rows="3" style="background-color: rgb(46, 46, 46);"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">ì‘ì„±ì™„ë£Œ</button>
            </form>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra-script %}
<script>
    function toggleButtonColor() {
        const btn = document.getElementById('toggle-btn');
        addToCart(); // ì°œí•˜ê¸° ë™ì‘ ìˆ˜í–‰
    }

    function addToCart() {
        const addBtn = document.getElementById('toggle-btn');
        axios({
            method: 'get',
            url: '{% url "carts:add_song" %}',
            params: {
                songid: '{{ song.id }}'
            }
        })
            .then(response => {
                addBtn.classList.remove('btn-outline-light');
                addBtn.classList.add('btn-outline-light-rm');
                addBtn.textContent = 'â¤ï¸';
                alert('ì°œ ëª©ë¡ì— "{{ song.title }}"ì„(ë¥¼) ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.');
            })
            .catch(error => console.log(error));
    }
</script>
{% endblock extra-script %}
