{% load session_filters %}
{% load thumbnail %}

<style>
    /* ì „ì²´ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar {
        width: 10px; /* ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ */
    }

    /* ìŠ¤í¬ë¡¤ë°”ì˜ track (ë°°ê²½) ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar-track {
        background-color: #000000; /* ìŠ¤í¬ë¡¤ë°” ë°°ê²½ìƒ‰ */
    }

    /* ìŠ¤í¬ë¡¤ë°”ì˜ thumb (ë°” ë¶€ë¶„) ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar-thumb {
        background-color: #888; /* ìŠ¤í¬ë¡¤ë°” ìƒ‰ìƒ */
        border-radius: 50px; /* ìŠ¤í¬ë¡¤ë°” ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° */
    }

    /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìŠ¤í¬ë¡¤ë°” thumb ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar-thumb:hover {
        background-color: #555; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìŠ¤í¬ë¡¤ë°” ìƒ‰ìƒ ë³€ê²½ */
    }
</style>

<div class="container p-0 mt-1 px-3">
    <div class="row justify-content-between align-items-center bg-dark p-2 shadow rounded-2" style="border: 1px solid hsla(0, 0%, 100%, .3);">
        {% thumbnail song.thumbnail "70x70" crop="center" as thumb %}
            <a href="{% url 'songs:song_detail' song.id %}" style="padding: 0; display: inline; width: 70px;">
                <img src="{{ thumb.url }}" alt="" style="width: 70px; height: 70px; padding: 0;">
            </a>
        {% endthumbnail %}
        <div class="col">
            {% if forloop.counter <= 3 %} 
                <span style="margin-right: 2px; color: yellow;">New</span>
            {% endif %}
            <a class="text-decoration-none" href="{% url 'songs:song_detail' song.id %}">
                <!-- ë…¸ë˜ ì„¸ë¶€ ë‚´ìš© í˜ì´ì§€ë¡œ ë§í¬ -->
                <h5 class="text-white mb-0">{{ song.title }}</h5>
                <small class="fs-6" style="color: #888888;">
                    <a class="text-decoration-none" style="color: #888;" href="{% url 'sellers:seller_artist' song.seller.user.id %}">{{ song.seller }}</a>
                </small>
            </a>
        </div>
        <div class="col-auto d-flex align-items-center">
            <audio controls class="me-0" controlsList="nodownload">
                <source src="{{ song.mp3.url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
    </div>
</div>

<div class="container p-0 mt-1 px-3" style="overflow-x: auto; white-space: nowrap;">
    {% for song in page_obj %}
        <div class="d-inline-block shadow rounded-2 m-1" style="width: 200px; display: inline-block; vertical-align: top; border: none;">
            <div style="width: 100%; height: 150px; overflow: hidden; border-radius: 8px;">
                <a href="{% url 'songs:song_detail' song.id %}" style="display: block; height: 100%;">
                    <img src="{{ song.thumbnail.url }}" alt="" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;">
                </a>
            </div>
            <div class="p-2">
                <div>
                    <span style="color: yellow;">New!!</span>
                    <a class="text-decoration-none" href="{% url 'songs:song_detail' song.id %}">
                        <!-- ë…¸ë˜ ì„¸ë¶€ ë‚´ìš© í˜ì´ì§€ë¡œ ë§í¬ -->
                        <h6 class="text-white mb-0" style="font-size: 14px;">{{ song.title }}</h6>
                    </a>
                    <small class="fs-6" style="color: #888;">
                        <a class="text-decoration-none" style="color: #888;" href="{% url 'sellers:seller_artist' song.seller.user.id %}">{{ song.seller }}</a>
                    </small>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <audio controls class="me-0" controlsList="nodownload" style="width: 100%;">
                        <source src="{{ song.mp3.url }}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    {% if user.is_authenticated %}
                        {% is_purchased user song.id as purchased %}
                        {% is_added_to_cart user song.id as added %}
                        
                        <!-- ì°œ ë²„íŠ¼ -->
                        {% if not added %}
                            <button id="add-btn-{{song.id}}" type="button" class="btn btn" onclick="addToCart('{{song.id}}');">ğŸ¤</button>
                        {% else %}
                            <button id="remove-btn-{{song.id}}" type="button" class="btn btn" onclick="removeFromCart('{{song.id}}');">â¤ï¸</button>
                        {% endif %}
                        
                        <!-- ê°€ì‚¬ ë³´ê¸° ë²„íŠ¼ -->
                        <button class="btn btn-sm btn" style="cursor: pointer;" data-id="{{ song.id }}" onclick="showLyrics(this.getAttribute('data-id'))">ğŸ“ƒ</button>
                        
                        {% if not purchased %}
                        <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
                        <form action="{% url 'payments:payment_pay' song.id %}" onsubmit="return confirmPurchase('{{ song.title|escapejs }}')">
                            <button class="btn btn-sm" type="submit">ğŸ’³</button>
                        </form>
                        {% else %}
                        <a href="{{ song.mp3.url }}" download="{{ song.title }}.mp3">
                            <button class="btn btn-sm">ğŸ’¾</button>
                        </a>
                        {% endif %}
                    {% else %}
                        <button type="button" class="btn btn-sm btn" onclick="gotoLogin();">ğŸ¤</button>
                        <button class="btn btn-sm btn" type="submit" onclick="gotoLogin();">ğŸ’³</button>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>
